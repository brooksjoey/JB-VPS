#!/usr/bin/env bash
set -euo pipefail
JB_DIR="/home/jb/JB-VPS"
source "$JB_DIR/lib/base.sh"

# Register core commands
jb_register "menu" "jb_menu" "Launch the interactive menu system" "core"
jb_register "help" "jb_help" "Show available commands" "core"

# Core command implementations
jb_menu() {
    exec "$JB_DIR/bin/menu.sh" "$@"
}

# Load every plugin (each should call jb_register)
shopt -s nullglob
for p in "$JB_DIR/plugins"/*/plugin.sh; do
  source "$p"
done
shopt -u nullglob

cmd="${1:-menu}"; shift || true
if [[ -z "${JB_CMDS_FUNC[$cmd]:-}" ]]; then
  jb_help; exit 1
fi
"${JB_CMDS_FUNC[$cmd]}" "$@"
